<!doctype html>
<html class="client-js vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-enabled vector-feature-main-menu-pinned-disabled vector-feature-limited-width-enabled vector-feature-limited-width-content-enabled vector-feature-custom-font-size-enabled vector-feature-appearance-disabled vector-feature-appearance-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-night" lang="en" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Flashlight - Wikipedia</title>
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<style>
/* Wikipedia mobile-first styling */
* {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Lato', 'Liberation Sans', sans-serif;
    font-size: 14px;
    line-height: 1.6;
    color: #202122;
    background-color: #fff;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    touch-action: manipulation;
}

.vector-header-container {
    position: sticky;
    top: 0;
    z-index: 100;
    border-bottom: 1px solid #a2a9b1;
    background: #f8f9fa;
    padding: 8px 12px;
}

.vector-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.vector-logo {
    font-weight: bold;
    font-size: 1.2em;
    color: #000;
}

.vector-menu-tabs {
    display: none;
}

.mw-body {
    padding: 12px;
    max-width: 100%;
    overflow-wrap: break-word;
}

.firstHeading {
    font-family: 'Linux Libertine', 'Georgia', 'Times', serif;
    font-weight: normal;
    margin: 0 0 8px 0;
    padding: 0;
    font-size: 1.8em;
    line-height: 1.2;
    border-bottom: 1px solid #a2a9b1;
}

.hatnote {
    font-style: italic;
    padding: 4px 0;
    margin-bottom: 12px;
    font-size: 0.9em;
    color: #54595d;
}

.infobox {
    border: 1px solid #a2a9b1;
    background-color: #f8f9fa;
    color: black;
    margin: 12px 0;
    padding: 8px;
    font-size: 13px;
    line-height: 1.4;
    width: 100%;
    float: none;
}

.infobox caption {
    font-size: 16px;
    font-weight: bold;
    padding: 4px 0 8px 0;
    text-align: center;
}

.infobox th, .infobox td {
    vertical-align: top;
    text-align: left;
    padding: 4px 6px;
}

.thumbinner {
    border: 1px solid #c8ccd1;
    padding: 6px;
    background-color: #f8f9fa;
    text-align: center;
    margin: 8px auto;
    max-width: 100%;
}

.thumbimage {
    max-width: 100%;
    height: auto;
}

.thumbcaption {
    font-size: 12px;
    color: #54595d;
    margin-top: 6px;
    line-height: 1.4;
}

.mw-parser-output h2 {
    font-family: 'Linux Libertine', 'Georgia', 'Times', serif;
    border-bottom: 1px solid #a2a9b1;
    font-weight: normal;
    margin: 24px 0 8px 0;
    padding: 0;
    font-size: 1.4em;
}

.toc {
    display: none;
}

/* Interactive elements */
#secret, .firstHeading {
    cursor: pointer;
    transition: all 0.3s ease;
    -webkit-user-select: none;
    user-select: none;
}

#secret:hover, .firstHeading:hover {
    background-color: #f8f9fa;
}

#st {
    width: 6px;
    height: 6px;
    border-radius: 6px;
    background: #36c;
    opacity: 0;
    transition: opacity 0.3s ease;
}

#st.active {
    opacity: 1;
}

#v {
    position: fixed;
    left: -9999px;
    width: 160px;
    height: 120px;
    opacity: 0;
    pointer-events: none;
}

#blk {
    position: fixed;
    inset: 0;
    background: #000;
    display: none;
    z-index: 9999;
    pointer-events: none;
}

/* Mobile menu */
.mobile-menu {
    display: flex;
    gap: 16px;
    font-size: 14px;
}

.mobile-menu a {
    color: #36c;
    text-decoration: none;
}

/* Status indicator */
.status-indicator {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #ccc;
    z-index: 1000;
    transition: all 0.3s ease;
}

.status-indicator.armed {
    background: #ff6b35;
    animation: pulse 2s infinite;
}

.status-indicator.active {
    background: #4CAF50;
    box-shadow: 0 0 10px #4CAF50;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

/* Instruction overlay */
.instruction-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.8);
    color: white;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    padding: 20px;
    text-align: center;
}

.instruction-overlay.active {
    display: flex;
}

.instruction-icon {
    font-size: 48px;
    margin-bottom: 20px;
}

/* Tablet and desktop */
@media (min-width: 768px) {
    body {
        font-size: 14px;
    }
    
    .mw-body {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .infobox {
        float: right;
        width: 300px;
        margin: 0 0 12px 20px;
    }
    
    .vector-menu-tabs {
        display: block;
    }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
    body {
        background-color: #101418;
        color: #f8f9fa;
    }
    
    .vector-header-container {
        background: #1e2125;
        border-bottom-color: #404448;
    }
    
    .infobox {
        background-color: #1e2125;
        border-color: #404448;
    }
    
    .firstHeading {
        border-bottom-color: #404448;
    }
}
</style>
</head>
<body>
<div class="vector-header-container">
    <header class="vector-header">
        <div class="vector-logo">Wikipedia</div>
        <div class="mobile-menu">
            <a href="#article">Article</a>
            <a href="#talk">Talk</a>
        </div>
    </header>
</div>

<div class="mw-body">
    <h1 class="firstHeading">Flashlight<span id="st"></span></h1>
    
    <div class="hatnote">
        For other uses, see <a href="/wiki/Flashlight_(disambiguation)">Flashlight (disambiguation)</a>.
    </div>
    <div class="hatnote">
        Not to be confused with <a href="/wiki/Torch">Torch</a>.
    </div>

    <table class="infobox">
        <caption>Flashlight</caption>
        <tbody>
            <tr>
                <td colspan="2" style="text-align: center">
                    <div class="thumbinner">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d7/3x_AA_to_D_battery_converter%2C_MY_DAY_vintage_flashlight%2C_Sofirn_SP36_flashlight.jpg/500px-3x_AA_to_D_battery_converter%2C_MY_DAY_vintage_flashlight%2C_Sofirn_SP36_flashlight.jpg" alt="Various flashlights" class="thumbimage">
                        <div class="thumbcaption">
                            A set of modern LED flashlights. Left to right: 3x AA to D parallel battery converter, MY DAY vintage flashlight, Sofirn SP36 flashlight.
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <th>Other names</th>
                <td>Electric torch, torch</td>
            </tr>
            <tr>
                <th>Classification</th>
                <td>Portable hand-held electric light</td>
            </tr>
            <tr>
                <th>Uses</th>
                <td>Illumination</td>
            </tr>
            <tr>
                <th>Invented</th>
                <td>1899</td>
            </tr>
        </tbody>
    </table>

    <div class="mw-parser-output">
        <p>A <b>flashlight</b> <span id="secret">(North American English)</span> or <b>electric torch</b> (Commonwealth English), usually shortened to <b>torch</b>, is a portable hand-held electric lamp. Formerly, the light source typically was a miniature incandescent light bulb, but these have been displaced by light-emitting diodes (LEDs) since the early 2000s. A typical flashlight consists of the light source mounted in a reflector, a transparent cover (sometimes combined with a lens) to protect the light source and reflector, a battery, and a switch, all enclosed in a case.</p>

        <p>The invention of the dry cell and miniature incandescent electric lamps made the first battery-powered flashlights possible around 1899. Today, flashlights use mostly light-emitting diodes and run on disposable or rechargeable batteries. Some are powered by the user turning a crank, shaking the lamp, or squeezing it. Some have solar panels to recharge the battery. Flashlights are used as a light source outdoors, in places without permanently installed lighting, during power outages, or when a portable light source is needed.</p>

        <p>In addition to the general-purpose, hand-held flashlight, many forms have been adapted for special uses. Head- or helmet-mounted flashlights designed for miners and campers leave the hands free. Some flashlights can be used underwater or in flammable atmospheres.</p>

        <h2><span class="mw-headline" id="History">History</span></h2>
        <p>The first mass-produced dry cell batteries emerged in the 1890s, and the invention of miniature incandescent electric lamps made the first battery-powered flashlights possible. The first flashlight was invented in 1899 by British inventor David Misell.</p>

        <h2><span class="mw-headline" id="Components">Components</span></h2>
        <p>Early flashlights used incandescent light bulbs, but these have been largely replaced by LED technology due to higher efficiency and longer lifespan. Most flashlights use disposable or rechargeable batteries, with reflectors to direct light into beams.</p>

    </div>
</div>

<!-- Status and UI elements -->
<div class="status-indicator" id="statusIndicator"></div>

<div class="instruction-overlay" id="instructionOverlay">
    <div class="instruction-icon">ðŸ‘‹</div>
    <h3>Flashlight Control Active</h3>
    <p>Completely cover the camera with your hand to toggle the flashlight</p>
    <p><small>Triple-tap the heading again to disable</small></p>
</div>

<video id="v" autoplay playsinline muted></video>
<div id="blk"></div>

<script>
/* ================= ENHANCED CONFIG ================= */
const CFG = {
  // Activation
  TAP_COUNT: 3,
  TAP_WIN: 800,
  
  // Detection
  TICK_MS: 150,
  SESSION_MS: 10 * 60 * 1000, // 10 minutes
  SAMPLE_W: 160,
  SAMPLE_H: 120,
  
  // Hand covering detection (intentional gesture)
  DARK_THRESHOLD: 15,        // Very dark - hand completely covering
  LIGHT_THRESHOLD: 80,       // Normal light level
  COVER_DURATION: 800,       // ms hand must be covering
  UNCOVER_DURATION: 300,     // ms after uncover to trigger
  
  // Safety
  COOLDOWN_MS: 1200,
  INACT_MS: 5 * 60 * 1000,   // 5 minutes inactivity timeout
  
  // Visual feedback
  SHOW_INSTRUCTIONS: true,
  INSTRUCTION_TIMEOUT: 4000
};

/* =================================================== */

const s = document.getElementById('secret'),
      h = document.querySelector('.firstHeading'),
      st = document.getElementById('st'),
      v = document.getElementById('v'),
      blk = document.getElementById('blk'),
      statusIndicator = document.getElementById('statusIndicator'),
      instructionOverlay = document.getElementById('instructionOverlay');

let ms = null, tr = null, wl = null;
let stt = 0; // 0: idle, 1: armed_off, 2: armed_on
let itv = null, tmo = null, inactT = null;
let cleaned = 0;
let lastToggle = 0;

// Hand covering detection state
let coverStartTime = 0;
let isCovered = false;
let hasTriggered = false;

function updateStatus() {
    statusIndicator.className = 'status-indicator';
    if (stt === 0) {
        statusIndicator.style.display = 'none';
    } else if (stt === 1) {
        statusIndicator.style.display = 'block';
        statusIndicator.classList.add('armed');
    } else if (stt === 2) {
        statusIndicator.style.display = 'block';
        statusIndicator.classList.add('active');
    }
}

function showInstructions() {
    if (!CFG.SHOW_INSTRUCTIONS) return;
    instructionOverlay.classList.add('active');
    setTimeout(() => {
        instructionOverlay.classList.remove('active');
    }, CFG.INSTRUCTION_TIMEOUT);
}

function markActive(a) {
    const fs = a ? "italic" : "normal";
    const col = a ? "#36c" : "inherit";
    if (s) {
        s.style.fontStyle = fs;
        s.style.color = col;
    }
    if (h) h.style.fontStyle = fs;
    if (st) st.classList.toggle('active', a);
}

async function lock() {
    if (!("wakeLock" in navigator) || wl) return;
    try {
        wl = await navigator.wakeLock.request("screen");
        wl.addEventListener("release", () => { wl = null; });
    } catch(e) { wl = null; }
}

async function unlock() {
    try { wl && wl.release(); } catch(e) {}
    wl = null;
}

async function torch(vl) {
    if (!tr) return false;
    try {
        const c = tr.getCapabilities ? tr.getCapabilities() : {};
        if (!c.torch) return false;
        await tr.applyConstraints({advanced: [{torch: !!vl}]});
        return true;
    } catch(e) {
        console.error('Torch error:', e);
        return false;
    }
}

function lum() {
    if (!v.videoWidth || !v.videoHeight) return 0;
    try {
        const c = document.createElement('canvas');
        const x = c.getContext('2d');
        c.width = CFG.SAMPLE_W;
        c.height = CFG.SAMPLE_H;
        
        // Sample entire frame for hand covering detection
        x.drawImage(v, 0, 0, CFG.SAMPLE_W, CFG.SAMPLE_H);
        const d = x.getImageData(0, 0, CFG.SAMPLE_W, CFG.SAMPLE_H).data;
        
        let sL = 0, n = 0;
        for (let i = 0; i < d.length; i += 4) {
            sL += 0.299 * d[i] + 0.587 * d[i+1] + 0.114 * d[i+2];
            n++;
        }
        return n ? sL / n : 0;
    } catch(e) {
        return 0;
    }
}

/* Enhanced hand covering detection */
async function tick() {
    if (cleaned) return;
    const L = lum();
    if (!L) return;
    const now = performance.now();
    
    // Reset inactivity timer
    touchAct();
    
    if (stt === 0) return;
    
    // Hand covering detection logic
    if (L < CFG.DARK_THRESHOLD) {
        // Camera is covered
        if (!isCovered) {
            // Start covering
            isCovered = true;
            coverStartTime = now;
            hasTriggered = false;
        } else if (!hasTriggered && (now - coverStartTime) > CFG.COVER_DURATION) {
            // Covered long enough - prepare to trigger
            hasTriggered = true;
        }
    } else if (L > CFG.LIGHT_THRESHOLD) {
        // Camera is uncovered
        if (isCovered && hasTriggered && (now - lastToggle) > CFG.COOLDOWN_MS) {
            // Was covered and now uncovered - toggle flashlight
            const success = await torch(stt === 1);
            if (success) {
                stt = stt === 1 ? 2 : 1;
                lastToggle = now;
                updateStatus();
                
                // Show brief instructions when turning on
                if (stt === 2) {
                    showInstructions();
                }
            }
        }
        isCovered = false;
        hasTriggered = false;
    }
}

function startPoll() {
    if (itv) return;
    itv = setInterval(tick, CFG.TICK_MS);
    tmo = setTimeout(stopAll, CFG.SESSION_MS);
    markActive(true);
    updateStatus();
    showInstructions();
    lock();
}

function stopPoll() {
    if (itv) clearInterval(itv);
    itv = null;
    if (tmo) clearTimeout(tmo);
    tmo = null;
}

async function stopAll() {
    stopPoll();
    blkOff();
    await torch(false);
    if (ms) {
        ms.getTracks().forEach(t => t.stop());
    }
    ms = null;
    tr = null;
    lastToggle = 0;
    stt = 0;
    markActive(false);
    updateStatus();
    unlock();
    if (inactT) clearTimeout(inactT);
    inactT = null;
    
    // Reset covering state
    isCovered = false;
    hasTriggered = false;
    coverStartTime = 0;
}

function blkOn() { 
    if (blk) blk.style.display = 'block'; 
}
function blkOff() { 
    if (blk) blk.style.display = 'none'; 
}

function touchAct() {
    if (cleaned) return;
    if (inactT) clearTimeout(inactT);
    inactT = setTimeout(cleanExit, CFG.INACT_MS);
}

async function cleanExit() {
    if (cleaned) return;
    cleaned = 1;
    await stopAll();
}

/* Activation */
async function arm() {
    if (stt !== 0 || cleaned) return;
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert('Camera access not available');
        return;
    }
    
    try {
        ms = await navigator.mediaDevices.getUserMedia({
            video: {
                facingMode: 'environment',
                width: { ideal: 640 },
                height: { ideal: 480 }
            }
        });
        tr = ms.getVideoTracks()[0];
        v.srcObject = ms;
        
        const onReady = async () => {
            if (stt !== 0 || cleaned) return;
            stt = 1;
            lastToggle = performance.now();
            startPoll();
        };
        
        if (v.readyState >= 2) {
            await onReady();
        } else {
            v.onloadedmetadata = onReady;
        }
        
        try {
            await v.play();
        } catch(e) {
            console.error('Video play failed:', e);
        }
    } catch(e) {
        console.error('Camera access failed:', e);
        await stopAll();
        alert('Cannot access camera. Please check permissions.');
    }
}

/* Triple-tap activation */
(function() {
    let n = 0, to = null, lastT = 0, lastType = "";
    
    function tap(e) {
        const now = performance.now();
        
        // Prevent mixed touch/click within short time
        if (lastType && e.type !== lastType && now - lastT < 100) {
            lastType = e.type;
            lastT = now;
            return;
        }
        
        lastType = e.type;
        lastT = now;
        n++;
        
        if (to) clearTimeout(to);
        
        if (n >= CFG.TAP_COUNT) {
            n = 0;
            to = null;
            if (stt === 0) {
                arm();
            } else {
                stopAll();
            }
            touchAct();
        } else {
            to = setTimeout(() => {
                n = 0;
                to = null;
            }, CFG.TAP_WIN);
        }
    }
    
    [s, h].forEach(el => {
        if (!el) return;
        el.style.cursor = "pointer";
        el.addEventListener("click", tap, false);
        el.addEventListener("touchend", tap, false);
    });
})();

// Clean up on page exit
window.addEventListener("pagehide", cleanExit);
window.addEventListener("beforeunload", cleanExit);

// Initialize
updateStatus();
</script>
</body>
</html>
