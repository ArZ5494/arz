<!doctype html>
<html class="client-js vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-enabled vector-feature-main-menu-pinned-disabled vector-feature-limited-width-enabled vector-feature-limited-width-content-enabled vector-feature-custom-font-size-enabled vector-feature-appearance-disabled vector-feature-appearance-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-night" lang="en" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Flashlight - Wikipedia</title>
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
/* Wikipedia-style CSS */
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Lato, Helvetica, Arial, sans-serif;
    font-size: 0.875rem;
    line-height: 1.6;
    color: #202122;
    background-color: #fff;
    margin: 0;
    padding: 0;
}

.mw-body {
    margin-left: 10em;
    padding: 1em 1.5em 1.5em 1.5em;
}

.mw-body-header {
    border-bottom: 1px solid #a2a9b1;
    margin-bottom: 1em;
}

.firstHeading {
    font-family: 'Linux Libertine', 'Georgia', 'Times', serif;
    border-bottom: 1px solid #a2a9b1;
    font-weight: normal;
    margin: 0;
    padding-bottom: 0.25em;
}

.infobox {
    border: 1px solid #a2a9b1;
    border-spacing: 3px;
    background-color: #f8f9fa;
    color: black;
    margin: 0.5em 0 0.5em 1em;
    padding: 0.2em;
    float: right;
    clear: right;
    font-size: 88%;
    line-height: 1.5em;
    width: 22em;
}

.infobox caption {
    font-size: 125%;
    font-weight: bold;
    padding: 0.2em;
    text-align: center;
}

.infobox th, .infobox td {
    vertical-align: top;
    text-align: left;
    padding: 0.2em 0.4em;
}

.infobox tr:first-child th {
    text-align: center;
}

.hatnote {
    font-style: italic;
    padding: 0.2em 0;
    margin-bottom: 0.5em;
}

.mw-parser-output h2 {
    font-family: 'Linux Libertine', 'Georgia', 'Times', serif;
    border-bottom: 1px solid #a2a9b1;
    font-weight: normal;
    margin: 1em 0 0.25em 0;
    padding: 0;
}

.toc {
    display: table;
    border: 1px solid #a2a9b1;
    background-color: #f8f9fa;
    font-size: 95%;
    padding: 7px;
    margin: 0 0 1em 1em;
}

.toctitle {
    text-align: center;
}

/* Interactive elements (preserved from original) */
#secret, .firstHeading {
    cursor: pointer;
    transition: .25s;
}

#st {
    width: 6px;
    height: 6px;
    border-radius: 6px;
    background: #c5cdd6;
    opacity: .25;
    transition: .25s;
}

#v {
    position: fixed;
    left: -9999px;
    width: 160px;
    height: 120px;
    opacity: 0;
    pointer-events: none;
}

#blk {
    position: fixed;
    inset: 0;
    background: #000;
    display: none;
    z-index: 9999;
    pointer-events: none;
}

.vector-header-container {
    border-bottom: 1px solid #a2a9b1;
    background: #f8f9fa;
}

.vector-header {
    max-width: 99.75em;
    margin: 0 auto;
    padding: 0.5em 1.5em;
}

.vector-logo {
    font-weight: bold;
    font-size: 1.5em;
}
</style>
</head>
<body>
<div class="vector-header-container">
    <header class="vector-header">
        <div class="vector-logo">Wikipedia<span style="font-size: 0.7em; margin-left: 5px;">The Free Encyclopedia</span></div>
    </header>
</div>

<div class="mw-body">
    <div class="mw-body-header">
        <h1 class="firstHeading">Flashlight<span id="st"></span></h1>
    </div>

    <div class="mw-content-container">
        <div role="note" class="hatnote">For other uses, see <a href="/wiki/Flashlight_(disambiguation)" title="Flashlight (disambiguation)">Flashlight (disambiguation)</a>.</div>

        <table class="infobox">
            <caption>Flashlight</caption>
            <tbody>
                <tr>
                    <td colspan="2" style="text-align: center">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d7/3x_AA_to_D_battery_converter%2C_MY_DAY_vintage_flashlight%2C_Sofirn_SP36_flashlight.jpg/500px-3x_AA_to_D_battery_converter%2C_MY_DAY_vintage_flashlight%2C_Sofirn_SP36_flashlight.jpg" alt="LED flashlight" style="width: 200px;">
                        <div style="font-size: 0.8em; color: #54595d; margin-top: 5px;">Typical modern LED flashlight</div>
                    </td>
                </tr>
                <tr>
                    <th>Other names</th>
                    <td>Electric torch</td>
                </tr>
                <tr>
                    <th>Classification</th>
                    <td>Portable hand-held electric light</td>
                </tr>
                <tr>
                    <th>Uses</th>
                    <td>Illumination, emergency, outdoor</td>
                </tr>
                <tr>
                    <th>Invented</th>
                    <td>1899</td>
                </tr>
                <tr>
                    <th>Related items</th>
                    <td>Lantern, headlamp</td>
                </tr>
            </tbody>
        </table>

        <div class="mw-parser-output">
            <p>A <b>flashlight</b> <span id="secret">(US)</span> or <b>electric torch</b> (CE), usually shortened to <b>torch</b>, is a portable hand-held electric lamp. Formerly, the light source typically was a miniature incandescent light bulb, but these have been displaced by light-emitting diodes (LEDs) since the early 2000s. A typical flashlight consists of the light source mounted in a reflector, a transparent cover (sometimes combined with a lens) to protect the light source and reflector, a battery, and a switch, all enclosed in a case.</p>

            <p>The invention of the dry cell and miniature incandescent electric lamps made the first battery-powered flashlights possible around 1899. Today, flashlights use mostly light-emitting diodes and run on disposable or rechargeable batteries. Some are powered by the user turning a crank, shaking the lamp, or squeezing it. Some have solar panels to recharge the battery. Flashlights are used as a light source outdoors, in places without permanently installed lighting, during power outages, or when a portable light source is needed.</p>

            <p>In addition to the general-purpose, hand-held flashlight, many forms have been adapted for special uses. Head- or helmet-mounted flashlights designed for miners and campers leave both hands free. Some flashlights can be used under water or in flammable atmospheres.</p>

            <div class="toc">
                <div class="toctitle">Contents</div>
                <ul>
                    <li><a href="#History">1 History</a></li>
                    <li><a href="#Components">2 Components</a>
                    <ul>
                        <li><a href="#Light_sources">2.1 Light sources</a></li>
                        <li><a href="#Power_sources">2.2 Power sources</a></li>
                        <li><a href="#Reflectors_and_lenses">2.3 Reflectors and lenses</a></li>
                    </ul>
                    </li>
                    <li><a href="#Types_and_specialized_designs">3 Types and specialized designs</a></li>
                    <li><a href="#Applications">4 Applications</a></li>
                </ul>
            </div>

            <h2><span id="History">History</span></h2>
            <p>The first mass-produced dry cell batteries emerged in the 1890s, and the invention of miniature incandescent electric lamps made the first battery-powered flashlights possible. The first flashlight was invented in 1899 by British inventor David Misell.</p>

            <h2><span id="Components">Components</span></h2>
            <h3><span id="Light_sources">Light sources</span></h3>
            <p>Early flashlights used incandescent light bulbs, but these have been largely replaced by LED technology due to higher efficiency and longer lifespan.</p>

            <h3><span id="Power_sources">Power sources</span></h3>
            <p>Most flashlights use disposable or rechargeable batteries. Some specialized models use alternative power sources such as hand cranks or solar panels.</p>

            <h3><span id="Reflectors_and_lenses">Reflectors and lenses</span></h3>
            <p>Reflectors help direct the light into a beam, while lenses protect the light source and can focus the beam.</p>

            <h2><span id="Types_and_specialized_designs">Types and specialized designs</span></h2>
            <p>Various specialized flashlight designs include headlamps, underwater lights, and explosion-proof models for hazardous environments.</p>

            <h2><span id="Applications">Applications</span></h2>
            <p>Flashlights are used for outdoor activities, emergency situations, professional work in dark environments, and general household use.</p>

            <div style="font-size: 0.8rem; color: #54595d; margin-top: 2em; padding-top: 1em; border-top: 1px solid #eaecf0;">
                <strong>Interactive note:</strong> Triple-tap "Flashlight" (heading or inline) to arm. Phone face-down → screen goes black. Use light/cover or firm tap to toggle.
            </div>
        </div>
    </div>
</div>

<video id="v" autoplay playsinline muted></video>
<div id="blk"></div>

<script>
/* ================= CONFIG: TUNE HERE ONLY ================= */
const CFG={
  TAP_COUNT:3,           // taps to arm/disarm
  TAP_WIN:600,           // max gap (ms) between taps
  TICK_MS:120,           // polling interval
  SESSION_MS:12e5,       // auto stop safety (ms)
  SAMPLE_W:160,
  SAMPLE_H:120,

  UP_F:4,                // OFF->ON: L > blOff * UP_F
  DN_F:3,                // ON->OFF: L < blOn / DN_F
  BASE_FR:8,             // frames needed to lock baseline
  TRIG_FR:3,             // frames over/under threshold to trigger
  COOLDOWN_MS:900,       // min gap between toggles

  DARK_LIM:18,           // avg L considered "very dark"
  BUMP_THR:2.2,          // accel magnitude for "crisp" bump
  DARK_BWIN:700,         // ms: bump must be near now in dark

  BLK_LIM:35,            // L threshold for auto-black screen
  INACT_MS:600000        // inactivity before clean exit (ms)
};
/* ========================================================== */

const s=document.getElementById('secret'),
      h=document.querySelector('.firstHeading'),
      v=document.getElementById('v'),
      blk=document.getElementById('blk');

let ms=null,tr=null,wl=null;
let stt=0;                 // 0 idle,1 armed_off,2 armed_on
let blOff=0,blOn=0;
let oPrev=0,oCnt=0,oAcc=0;
let nPrev=0,nCnt=0,nAcc=0;
let upCnt=0,dnCnt=0;
let lastToggle=0;
let itv=null,tmo=null;
let lastBump=0;
let inactT=null,cleaned=0;

function mark(a){
  const fs=a?"italic":"normal";
  if(s)s.style.fontStyle=fs;
  if(h)h.style.fontStyle=fs;
}
function blkOn(){blk.style.display='block';}
function blkOff(){blk.style.display='none';}

function touchAct(){
  if(cleaned)return;
  if(inactT)clearTimeout(inactT);
  inactT=setTimeout(cleanExit,CFG.INACT_MS);
}

async function lock(){
  if(!("wakeLock" in navigator)||wl)return;
  try{
    wl=await navigator.wakeLock.request("screen");
    wl.addEventListener("release",()=>{wl=null;});
  }catch(e){wl=null;}
}
async function unlock(){
  try{wl&&wl.release();}catch(e){}
  wl=null;
}

async function torch(vl){
  if(!tr)return;
  try{
    const c=tr.getCapabilities?tr.getCapabilities():{};
    if(!c.torch)return;
    await tr.applyConstraints({advanced:[{torch:!!vl}]});
  }catch(e){}
}

function lum(){
  if(!v.videoWidth||!v.videoHeight)return 0;
  try{
    const c=document.createElement('canvas'),x=c.getContext('2d');
    c.width=CFG.SAMPLE_W;c.height=CFG.SAMPLE_H;
    x.drawImage(v,0,0,CFG.SAMPLE_W,CFG.SAMPLE_H);
    const d=x.getImageData(
      CFG.SAMPLE_W*0.25,
      CFG.SAMPLE_H*0.2,
      CFG.SAMPLE_W*0.5,
      CFG.SAMPLE_H*0.6
    ).data;
    let sL=0,n=0;
    for(let i=0;i<d.length;i+=4){
      sL+=0.299*d[i]+0.587*d[i+1]+0.114*d[i+2];
      n++;
    }
    return n?sL/n:0;
  }catch(e){return 0;}
}

/* baselines */
function calOff(L){
  if(!L)return;
  if(!oPrev){oPrev=L;oCnt=1;oAcc=L;return;}
  if(Math.abs(L-oPrev)<6){oCnt++;oAcc+=L;oPrev=L;}
  else{oCnt=1;oAcc=L;oPrev=L;}
  if(oCnt>=CFG.BASE_FR)blOff=oAcc/oCnt;
}
function calOn(L){
  if(!L)return;
  if(!nPrev){nPrev=L;nCnt=1;nAcc=L;return;}
  if(Math.abs(L-nPrev)<8){nCnt++;nAcc+=L;nPrev=L;}
  else{nCnt=1;nAcc=L;nPrev=L;}
  if(nCnt>=CFG.BASE_FR)blOn=nAcc/nCnt;
}

/* devicemotion for dark fallback */
function dmHandler(e){
  const a=e.accelerationIncludingGravity||e.acceleration;
  if(!a)return;
  const x=a.x||0,y=a.y||0,z=a.z||0;
  const mag=Math.sqrt(x*x+y*y+z*z);
  if(mag>CFG.BUMP_THR){
    lastBump=performance.now();
    touchAct();
  }
}
function enableDM(){
  lastBump=0;
  if(typeof DeviceMotionEvent!=="undefined" && DeviceMotionEvent.requestPermission){
    DeviceMotionEvent.requestPermission().then(p=>{
      if(p==="granted")window.addEventListener("devicemotion",dmHandler);
    }).catch(()=>{});
  }else{
    window.addEventListener("devicemotion",dmHandler);
  }
}
function disableDM(){
  window.removeEventListener("devicemotion",dmHandler);
  lastBump=0;
}

/* main tick */
async function tick(){
  if(cleaned)return;
  const L=lum();
  if(!L)return;
  const now=performance.now();

  // auto black screen while armed & dark
  if(stt!==0 && blOff && blOff<CFG.BLK_LIM && L<CFG.BLK_LIM) blkOn();
  else if(stt===0 || L>CFG.BLK_LIM*1.5) blkOff();

  // shared dark+bump fallback: if very dark + crisp bump near now → toggle
  if(stt!==0 && blOff && blOff<CFG.DARK_LIM && lastBump){
    if(now-lastBump<CFG.DARK_BWIN && now-lastToggle>CFG.COOLDOWN_MS){
      const turnOn = (stt===1);
      await torch(turnOn);
      stt = turnOn ? 2 : 1;
      if(turnOn){
        blOn=0;nPrev=nCnt=nAcc=0;
      }else{
        blOff=0;oPrev=oCnt=oAcc=0;
      }
      upCnt=dnCnt=0;
      lastToggle=now;
      lastBump=0;
      touchAct();
      return;
    }
  }

  if(stt===1){ // ARMED_OFF
    if(!blOff){calOff(L);return;}

    // optical OFF -> ON: strong spike
    if(L>blOff*CFG.UP_F) upCnt++;
    else if(L<blOff*2) upCnt=0;

    if(upCnt>=CFG.TRIG_FR && now-lastToggle>CFG.COOLDOWN_MS){
      await torch(true);
      stt=2;
      blOn=0;nPrev=nCnt=nAcc=0;
      upCnt=0;dnCnt=0;
      lastToggle=now;
      touchAct();
      return;
    }

  }else if(stt===2){ // ARMED_ON
    if(!blOn){calOn(L);return;}

    // optical ON -> OFF: strong dark drop
    if(L<blOn/CFG.DN_F) dnCnt++;
    else if(L>blOn/1.5) dnCnt=0;

    if(dnCnt>=CFG.TRIG_FR && now-lastToggle>CFG.COOLDOWN_MS){
      await torch(false);
      stt=1;
      blOff=0;oPrev=oCnt=oAcc=0;
      upCnt=0;dnCnt=0;
      lastToggle=now;
      touchAct();
      return;
    }
  }
}

/* loops */
function startPoll(){
  if(itv)return;
  itv=setInterval(tick,CFG.TICK_MS);
  tmo=setTimeout(stopAll,CFG.SESSION_MS);
  mark(1);
  touchAct();
}
function stopPoll(){
  if(itv)clearInterval(itv);
  itv=null;
  if(tmo)clearTimeout(tmo);
  tmo=null;
}

/* stop core */
async function stopAll(){
  stopPoll();
  disableDM();
  blkOff();
  await torch(false);
  if(ms)ms.getTracks().forEach(t=>t.stop());
  ms=null;tr=null;
  blOff=blOn=0;
  oPrev=oCnt=oAcc=0;
  nPrev=nCnt=nAcc=0;
  upCnt=0;dnCnt=0;
  lastToggle=0;
  stt=0;
  mark(0);
  unlock();
  if(inactT)clearTimeout(inactT);
  inactT=null;
}

/* clean exit */
async function cleanExit(){
  if(cleaned)return;
  cleaned=1;
  await stopAll();
  try{location.replace("https://www.google.com");}catch(e){}
}

/* arm */
async function arm(){
  if(stt!==0||cleaned)return;
  if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return;
  try{
    ms=await navigator.mediaDevices.getUserMedia({
      video:{facingMode:'environment',width:{ideal:640},height:{ideal:480}}
    });
    tr=ms.getVideoTracks()[0];
    v.srcObject=ms;
    const onReady=async()=>{
      if(stt!==0||cleaned)return;
      stt=1;
      blOff=blOn=0;
      oPrev=oCnt=oAcc=0;
      nPrev=nCnt=nAcc=0;
      upCnt=dnCnt=0;
      lastToggle=performance.now();
      enableDM();
      startPoll();
      lock();
    };
    if(v.readyState>=2)onReady();else v.onloadedmetadata=onReady;
    try{await v.play();}catch(e){}
  }catch(e){
    await stopAll();
  }
}

/* triple-tap: IDLE <-> ARMED */
(function(){
  let n=0,to=null,lastT=0,lastType="";
  function tap(e){
    const now=performance.now();
    if(lastType && e.type!==lastType && now-lastT<80){
      lastType=e.type;lastT=now;return;
    }
    lastType=e.type;lastT=now;
    n++;
    if(to)clearTimeout(to);
    if(n>=CFG.TAP_COUNT){
      n=0;to=null;
      if(stt===0)arm();else stopAll();
      touchAct();
    }else{
      to=setTimeout(()=>{n=0;to=null},CFG.TAP_WIN);
    }
  }
  [s,h].forEach(el=>{
    if(!el)return;
    el.style.cursor="pointer";
    el.addEventListener("click",tap,false);
    el.addEventListener("touchend",tap,false);
  });
})();

window.addEventListener("pagehide",cleanExit);
window.addEventListener("beforeunload",cleanExit);
</script>
</body>
</html>
