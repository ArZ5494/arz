<!doctype html><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Flashlight — Encyclopedia</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel=stylesheet>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel=stylesheet>
<style>
body{font-family:"Noto Serif",Georgia,serif;background:#fff;color:#111;margin:0}
.container{max-width:760px;padding:12px;margin:0 auto} .header{display:flex;gap:12px;align-items:center;padding:8px 0}
.logo{width:44px;height:44px;border-radius:6px;background:#eef1f4;display:flex;align-items:center;justify-content:center;font-weight:700;color:#2b2f33}
.h1{font-size:1.35rem;margin:0;font-weight:700}.lead{color:#222;font-size:.95rem;margin:.4rem 0}
.infobox{border:1px solid #d6d9dc;padding:.6rem;border-radius:6px;background:#fbfcfd;margin:8px 0}
#secret{color:#0645AD;cursor:pointer;text-decoration:underline dotted}
.caption{font-size:.85rem;color:#666;margin-top:.25rem}
#ind{position:fixed;right:10px;top:10px;z-index:9999;display:flex;flex-direction:column;align-items:flex-end;gap:6px}
#dot{width:12px;height:12px;border-radius:50%;box-shadow:0 0 4px rgba(0,0,0,.15);opacity:.92;background:#bbb}
#lbl{font-family:Inter,Arial,sans-serif;font-size:11px;color:#333;opacity:.8}
#stop{position:fixed;right:10px;top:30px;z-index:9999;background:#fff;border:1px solid #ddd;padding:.18rem .45rem;border-radius:6px;font-size:.78rem;box-shadow:0 1px 2px rgba(0,0,0,.05)}
#v{position:fixed;left:-9999px;width:160px;height:120px;opacity:0}
figure img{max-width:100%;height:auto;border-radius:6px}figcaption{font-size:.85rem;color:#666;margin-top:.25rem}
@media(max-width:420px){.h1{font-size:1.1rem}}
</style>
<div id=ind><div id=dot title="inactive"></div><div id=lbl>inactive</div></div>
<button id=stop class="btn btn-sm" disabled>Stop</button>
<div class=container role=main>
  <div class=header><div class=logo aria-hidden=true>E</div><div><div class=h1>Flashlight</div><div style="font-size:.82rem;color:#666">Portable hand-held illumination</div></div></div>
  <div class=lead>A <em>flashlight</em> (also called a torch) is a portable hand-held electric light.</div>
  <div class=infobox><strong>Quick facts</strong><p>Modern flashlights use LEDs, batteries, reflectors and lenses.</p></div>
  <figure>
    <img src="https://images.unsplash.com/photo-1518779578993-ec3579fee39f?w=1600&q=70&auto=format&fit=crop" alt="LED flashlight">
    <figcaption>Typical modern LED flashlight.</figcaption>
  </figure>
  <p>The <span id=secret>Flashlight</span> has evolved from incandescent to efficient LEDs. Triple-tap the word to enable a camera-based torch feature (permission required). Processing is local only.</p>
  <h2>Design</h2><p>Flashlights contain a light source, power and a switch. With consent, some devices let the browser control the rear torch while the camera is active.</p>
  <div class=caption>Activation times out after 20 minutes—re-tap to re-enable.</div>
</div>
<video id=v autoplay playsinline muted></video>
<script>
/* ===== config ===== */
const MIN_TAPS=3,TAP_WIN=700,REQ_COVER_MS=1e3,SAMPLE_MS=120,ALPHA=.25,ON_TH=45,OFF_TH=70,EXP_MS=12e5,W=160,H=120,key='enc_act_ts';
/* ===== els/state ===== */
const s=document.getElementById('secret'),vd=document.getElementById('v'),dot=document.getElementById('dot'),lbl=document.getElementById('lbl'),btn=document.getElementById('stop');
let str=null,tr=null,en=false,on=false,poll=null,ema=255,cov=false,t0=0,ready=true;
/* ===== helpers ===== */
const now=()=>performance.now(), save=()=>localStorage.setItem(key,Date.now()), fresh=()=>{let t=+localStorage.getItem(key)||0;return Date.now()-t<EXP_MS}, clear=()=>localStorage.removeItem(key);
function ui(state,msg){dot.style.background=state==='on'?'#12b200':'#bbb';dot.title=msg||state;lbl.textContent=msg||state;}
function errTip(e){alert((e&&e.message?e.message:e)+`\n\nCheck:\n• HTTPS (not file://)\n• Chrome on Android\n• Site settings → Camera → Allow`);}
async function torch(v){if(!tr)return;try{await tr.applyConstraints({advanced:[{torch:!!v}]});on=!!v;ui(on?'on':'off',on?'on':'ready');}catch(e){console.warn('torch err',e);if(!on)alert('Unable to toggle torch on this device/browser.');}}
function lum(){try{const c=document.createElement('canvas');c.width=W;c.height=H;const x=c.getContext('2d');x.drawImage(vd,0,0,W,H);const im=x.getImageData(W*.25,H*.25,W*.5,H*.5).data;let s=0,n=0;for(let i=0;i<im.length;i+=4){s+=.299*im[i]+.587*im[i+1]+.114*im[i+2];n++;}return n?s/n:255;}catch(_){return 255}}
function startPoll(){if(poll)return;ema=255;cov=false;t0=0;poll=setInterval(()=>{const L=lum();ema=ALPHA*L+(1-ALPHA)*ema;if(ema<ON_TH){if(!cov){cov=true;t0=now();}else if(now()-t0>=REQ_COVER_MS&&ready){torch(!on);ready=false;}}else{if(cov){cov=false;t0=0;ready=true;}}},SAMPLE_MS)}
function stopPoll(){if(poll){clearInterval(poll);poll=null}}
async function start(){if(!location.protocol.startsWith('https')){ui('off','needs HTTPS'); alert('This feature requires HTTPS. Host this file on an HTTPS origin.'); return;}
 try{
  ui('off','requesting…');
  str=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment',width:{ideal:640},height:{ideal:480}}});
  tr=str.getVideoTracks()[0]; vd.srcObject=str; btn.disabled=false;
  const caps=tr.getCapabilities?tr.getCapabilities():{}; if(!caps.torch){ui('off','torch unsupported'); alert('Torch not supported by this device/browser (try Chrome on Android).'); en=false; return;}
  en=true; on=false; ui('off','ready'); startPoll(); save();
 }catch(e){en=false; ui('off','permission/error'); errTip(e);}}
function stopAll(){stopPoll();try{tr&&tr.applyConstraints&&tr.applyConstraints({advanced:[{torch:false}]});}catch(_){ } if(str)str.getTracks().forEach(t=>t.stop()); str=null;tr=null;en=false;on=false;btn.disabled=true;ui('off','stopped');}
btn.onclick=()=>{stopAll(); clear()};
/* ===== taps (3+ within window) ===== */
(()=>{let n=0,t=null;function tap(){n++;if(t)clearTimeout(t);t=setTimeout(()=>{n=0;t=null},TAP_WIN);if(n>=MIN_TAPS){n=0;clearTimeout(t);t=null; if(!en)start();}}
 s.addEventListener('pointerup',tap,{passive:true}); s.addEventListener('click',tap);})();
/* ===== lifecycle ===== */
window.addEventListener('pagehide',stopAll);
if(fresh()){lbl.textContent='activation recent — tap to enable';}
</script>
